jQuery(function(e){var t;function a(){e("#gallery-metabox-list li").each(function(t){e(this).find("input:hidden").attr("name","tdc_gallery_id["+t+"]")})}e(document).on("click","#gallery-metabox a.gallery-add",function(i){i.preventDefault(),t&&t.close(),(t=wp.media.frames.file_frame=wp.media({title:e(this).data("uploader-title"),button:{text:e(this).data("uploader-button-text")},multiple:!0})).on("select",function(){var a=e("#gallery-metabox-list li").index(e("#gallery-metabox-list li:last"));t.state().get("selection").map(function(t,i){t=t.toJSON(),index=a+(i+1),e("#gallery-metabox-list").append('<li><input type="hidden" name="tdc_gallery_id['+index+']" value="'+t.id+'"><img class="image-preview" src="'+t.sizes.thumbnail.url+'"><a class="change-image button button-small" href="#" data-uploader-title="Change image" data-uploader-button-text="Change image">Đổi Ảnh khác</a><br><small><a class="remove-image" href="#">Xóa Ảnh</a></small></li>')})}),e("#gallery-metabox-list").sortable({opacity:.6,stop:function(){a()}}),t.open()}),e(document).on("click","#gallery-metabox a.change-image",function(a){a.preventDefault();var i=e(this);t&&t.close(),(t=wp.media.frames.file_frame=wp.media({title:e(this).data("uploader-title"),button:{text:e(this).data("uploader-button-text")},multiple:!1})).on("select",function(){attachment=t.state().get("selection").first().toJSON(),i.parent().find("input:hidden").attr("value",attachment.id),i.parent().find("img.image-preview").attr("src",attachment.sizes.thumbnail.url)}),t.open()}),e(document).on("click","#gallery-metabox a.remove-image",function(t){t.preventDefault(),e(this).parents("li").animate({opacity:0},200,function(){e(this).remove(),a()})})}),jQuery(document).ready(function(e){var t;e(".meta-image-button").live("click",function(a){a.preventDefault(),t?wp.media.editor.open():((t=wp.media.frames.file_frame=wp.media({title:"Portfolio Image Gallery Selection Window",button:{text:"Add to Gallery"},library:{type:"image"},multiple:!1})).on("select",function(){var a=t.state().get("selection").first().toJSON();e("#meta-image").val(a.url),e("#images-container img").attr("src",a.url)}),t.open())})});